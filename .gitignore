// Behavioral model of the SW Harrison street traffic signal system

module Counter(Clock, Load, Value, Count, Timeup);
input Clock, Load, Count;
input [7:0] Value;
output Timeup;
reg [7:0] c;
assign Timeup = (c == 0) ? 1 : 0;
always @(posedge Clock)
begin
  if (Load)
  c <= Value;
  else if (Count && (c != 0))
  c <= c - 8'b1;
  else
  c <= c;
end
endmodule


module SWHarrisonTrafficSignal(Clock, Clear, S1, S2, S3, L1, L2, L3);
input Clock,Clear,S1,S2,S3;
output [1:0] L1,L2,L3;
reg [1:0] L1,L2,L3;

parameter FAILSAFE = 2'b00;
parameter GREEN = 2'b01;
parameter YELLOW = 2'b10;
parameter RED = 2'b11;


parameter
   State0 = 6'b000001,
   State1 = 6'b000010,
   State2 = 6'b000100,
   State3 = 6'b001000,
   State4 = 6'b010000,
   State5 = 6'b100000;
   
reg Load,Count;
reg [7:0] Value;
wire Timeup;

Counter C1(Clock, Load, Value, Count, Timeup);

reg [5:0] State, NextState;

always @(posedge Clock)
begin
if(Clear)
   State <= State0;
else
   State <= NextState;
end

always @(State)
begin
case (State)
    State0 : begin
	L1 = GREEN;
	L2 = RED;
	L3 = RED;
	end
    State1 : begin
	L1 = YELLOW;
	L2 = RED;
	L3 = RED;
	end
     State2 : begin
	L1 = RED;
	L2 = RED;
	L3 = RED;
	end
      State3 : begin
	L1 = RED;
	L2 = GREEN;
	L3 = GREEN;
	end
      State4 : begin
	L1 = RED;
	L2 = YELLOW;
	L3 = YELLOW;
	end
      State5 : begin
	L1 = RED;
	L2 = RED;
	L3 = RED;
	end
endcase
end
	

always @( State or S1 or S2 or S3  or Timeup)
begin 
case (State)
	State0 : begin
	 Load = 0; 
	    if (Clear == 1)
	    begin
	      Load = 1;
	      Value = 8'b00101101;
	      Count = 1;
	      NextState = State0;
	   end
	   else if (Clear == 0)
	   begin
	      Load  = 0;
	      Count = 1;
	   if (Timeup == 1)
	   begin
	      if (S2 || S3)
	      begin
	        Load = 1;
	        Value = 8'b00000101;
	        NextState = State1;
	      end
	      else
	        NextState = State0;
	      end
           else
	      NextState = State0;
	   end
	   end   
	 State1 : begin
	    Load  = 0;
	    Count = 1;
	    if (Timeup)
	    begin
	     Load = 1;
	     Value = 8'b00000001;
	     NextState = State2;
	    end
	    else
	     NextState = State1;
	    end
	  State2 : begin
	    Load  = 0;
	    Count = 1;
	    if (Timeup)
	    begin
	     Load = 1;
	     Value = 8'b00001111;
	     NextState = State3;
	    end
	    else
	     NextState = State2;
	    end
	  State3 : begin
	   Load  = 0;
	   Count = 1;
	   if (Timeup)
	   begin
	    Load = 1;
	    Value = 8'b00000101;
	    NextState = State4;
	   end
	   else
	    NextState = State3;
	   end
	  State4 : begin
	   Load  = 0;
	   Count = 1;
	   if (Timeup)	
	   begin
	    Load = 1;
	    Value = 8'b00000001;
	    NextState = State5;
	   end
	   else
	    NextState = State4;
	   end
          State5 : begin
	    Load  = 0;
	    Count = 1;
	    if (Timeup)
	    begin
	     Load = 1;
	     Value = 8'b00101101;
	     NextState = State0;
	    end
	    else
	     NextState = State5;
	    end
	 
endcase
end  

endmodule

	
	
	  


  

